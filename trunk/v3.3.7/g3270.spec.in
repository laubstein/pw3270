%define _rexx	%(which oorexx-config > /dev/null 2>&1; if [ "$?" = "0" ]; then echo 1; else echo 0; fi)

Name:           @PACKAGE@
License:        GPL
Group:          System/X11/Terminals
Version:        @PACKAGE_VERSION@
Release:        0.%_vendor
Summary:        IBM 3270 Terminal emulator for gtk.
Source:         %{name}-%{version}.tar.gz
BuildRoot:      %{_tmppath}/%{name}-%{version}-build
Requires:       openssl shared-mime-info libgnome libgnomeui %{name}-lib = @PACKAGE_VERSION@
BuildRequires:  autoconf sed pkgconfig gtk2-devel libgnome-devel libgnomeui-devel

%description
IBM 3270 terminal emulator gtk. It can be used to communicate with
any IBM host that supports 3270-style connections over TELNET.

%package lib
Provides:	%{name}-lib
Summary:	3270 Communication library for %{name}
Group:		Development/Libraries
Requires:       openssl %{name}-lib
BuildRequires:  autoconf openssl-devel sed pkgconfig

%description lib
tn3270 protocol library for %{name}

%package devel
Provides:	%{name}-devel
Summary:	Devel for 3270 Communication library for %{name}
Group:		Development/Libraries

%description devel
devel for tn3270 protocol library for %{name}

%if 0%{?_rexx}
%package rexx
Provides:	%{name}-rexx
Summary:	Devel for 3270 Communication library for %{name}
Group:		Development/Libraries
Requires:       ooRexx %{name}-lib = @PACKAGE_VERSION@
BuildRequires:  ooRexx

%description rexx
Plugin to add Rexx support in %{name}

%endif

%prep

%setup -q -n %{name}-%{version}
autoconf
%configure --disable-trace

%build
make clean
make Release
make src/g3270/g3270.jpg
strip bin/Release/g3270
strip bin/Release/lib3270.so

%install
rm -rf $RPM_BUILD_ROOT
%makeinstall

# Desktop menu entry
cat > %{name}.desktop << EOF
[Desktop Entry]
Encoding=UTF-8
GenericName=%{name}
Name=3270 Terminal
Name[pt_BR]=Terminal 3270
Comment=IBM 3270 Terminal emulator
Exec=%{_bindir}/%{name}
Icon=%{_datadir}/%{name}/%{name}.jpg
Terminal=false
Type=Application
EOF

mkdir -p %{buildroot}%{_datadir}/applications

desktop-file-install    --vendor %{_build_vendor} \
                        --dir %{buildroot}%{_datadir}/applications \
                        --add-category TerminalEmulator \
                        %{name}.desktop


mkdir -p %{buildroot}%{_libdir}/pkgconfig
install -m 644 %{name}.pc %{buildroot}%{_libdir}/pkgconfig/%{name}.pc
install -m 644 ui/debug.xml %{buildroot}%{_datadir}/%{name}/ui/debug.xml

%if 0%{?_rexx}
install -m 644 ui/rexx.xml %{buildroot}%{_datadir}/%{name}/ui/rexx.xml
%endif

%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root)
%{_bindir}/%{name}
%{_datadir}/applications/*.desktop
%{_datadir}/locale/*/LC_MESSAGES/*.mo
%{_datadir}/%{name}/ui/%{name}.xml
%{_datadir}/%{name}/ui/%{name}.act
%{_datadir}/%{name}/%{name}.jpg
%{_datadir}/%{name}/colors.conf

%post
/sbin/ldconfig
/usr/bin/update-mime-database /usr/share/mime >/dev/null

%postun
/sbin/ldconfig
/usr/bin/update-mime-database /usr/share/mime >/dev/null

%files lib
%defattr(-,root,root)
%{_libdir}/lib3270.so

%files devel
%{_includedir}/lib3270
%{_libdir}/pkgconfig
%{_datadir}/%{name}/ui/debug.xml

%if 0%{?_rexx}
%files rexx
%defattr(-,root,root)
%{_libdir}/%{name}/plugins/rx3270.so
%{_datadir}/%{name}/ui/rexx.xml
%endif


