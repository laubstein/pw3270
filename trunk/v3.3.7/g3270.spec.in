Name:           @PACKAGE@
License:        GPL
Group:          System/X11/Terminals
Version:        @PACKAGE_VERSION@
Release:        0.%_vendor
Summary:        IBM 3270 Terminal emulator for gtk.
Source:         %{name}-%{version}.tar.gz
BuildRoot:      %{_tmppath}/%{name}-%{version}-build
Requires:       openssl shared-mime-info %{name}-lib libgnome libgnomeui
BuildRequires:  autoconf sed pkgconfig gtk2-devel libgnome-devel libgnomeui-devel

%description
IBM 3270 terminal emulator gtk. It can be used to communicate with
any IBM host that supports 3270-style connections over TELNET.

%package lib
Provides:	%{name}-lib
Summary:	3270 Communication library for %{name}
Group:		Development/Libraries
Requires:       openssl %{name}-lib
BuildRequires:  autoconf openssl-devel sed pkgconfig

%description lib
tn3270 protocol library for %{name}

%prep

%setup -q -n %{name}-%{version}
autoconf
%configure --disable-trace

%build
make clean
make Release
make src/g3270/g3270.jpg
strip bin/Release/g3270
strip bin/Release/lib3270.so

%install
rm -rf $RPM_BUILD_ROOT
%makeinstall

# Desktop menu entry
cat > %{name}.desktop << EOF
[Desktop Entry]
Encoding=UTF-8
GenericName=%{name}
Name=3270 Terminal
Name[pt_BR]=Terminal 3270
Comment=IBM 3270 Terminal emulator
Exec=%{_bindir}/%{name}
Icon=%{_datadir}/%{name}/%{name}.jpg
Terminal=false
Type=Application
EOF

mkdir -p %{buildroot}%{_datadir}/applications

desktop-file-install    --vendor %{_build_vendor} \
                        --dir %{buildroot}%{_datadir}/applications \
                        --add-category TerminalEmulator \
                        %{name}.desktop

#
# PKG-Config file
#cat > %{name}.pc << EOF
#prefix=%{_prefix}
#exec_prefix=%{_exec_prefix}
#libdir=%{_libdir}
#includedir=%{_includedir}/%{name}
#target=x11
#extension_prefix=%{_datadir}/%{name}/plugins
#extension_data=%{_datadir}/%{name}
#startup_script=%{_datadir}/%{name}/%{name}.sh
#
#Name: %{name}
#Description: GTK-3270 Terminal Emulator
#Version: %{version}-%{release}
#Requires: gtk+-2.0
#Libs: -L\${libdir} -l3270
#Cflags: -I\${includedir}/ -DG3270=\"%{version}-%{release}\" -DPLUGINPATH=\"%{_datadir}/%{name}/plugins\" -DPLUGINDATA=\"%{_datadir}/%{name}\"
#EOF
#
#install -m 644 %{name}.pc %{buildroot}%{_libdir}/pkgconfig/%{name}.pc
#

%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root)
%{_bindir}/%{name}
%{_datadir}/applications/*.desktop
%{_datadir}/locale/*/LC_MESSAGES/*.mo
%{_datadir}/%{name}/ui.xml
%{_datadir}/%{name}/%{name}.jpg

%config(noreplace) %{_datadir}/%{name}/*.conf

%post
/sbin/ldconfig
/usr/bin/update-mime-database /usr/share/mime >/dev/null

%postun
/sbin/ldconfig
/usr/bin/update-mime-database /usr/share/mime >/dev/null

%files lib
%defattr(-,root,root)
%{_libdir}



