%define _rel	0

%define _fedora		%(if [ -f /etc/fedora-release ]; then echo 1; else echo 0; fi)
%define _redhat		%(if [ -f /etc/redhat-release ]; then echo 1; else echo 0; fi)
%define _mandrake	%(if [ -f /etc/mandrake-release ]; then echo 1; else echo 0; fi)

%define _release	%{_rel}

%if 0%{?suse_version}
	%define _release %{_rel}.suse%{suse_version}
%endif

%if 0%{?mandriva_version}
	%define _release %{_rel}.mdk%{mandrake_version}
	%define _redhat 0
%endif

%if 0%{?fedora_version}
	%define _release %{_rel}.fc%{fedora_version}
	%define _redhat 0
%endif

%if 0%{?_redhat}
	%define _redhat_prefix      %(grep -q "Red Hat Linux" /etc/redhat-release && echo rhl || echo el)
	%define _redhat_vernum      %(rpm -qf --queryformat %{VERSION} /etc/redhat-release|tr -d '.')
	%define _release          	%{_rel}.%{_redhat_prefix}%{_redhat_vernum}
%endif

Name:           @PACKAGE@
Version:        @PACKAGE_VERSION@
Release:        %_release

%define	        ooo_prefix	%_libdir
%define	        ooo_home	ooo3

License:        GPL
Group:          Productivity/Office/Suite
Summary:        3270 calls for StarBasic.
Source:         %{name}-%{version}.tar.gz
BuildRoot:      %{_tmppath}/%{name}-%{version}-build
Requires:       pw3270-lib >= 4.0 OpenOffice_org-libs-core
BuildRequires:  autoconf sed pkgconfig zip OpenOffice_org-ure-devel

%description
Uno/OpenOffice library allowing 3270 access from StarBasic

%prep
%setup -q -n %{name}-%{version}
autoconf
%configure	--with-office-sdk-home=%{ooo_prefix}/%{ooo_home}/solver \
			--with-office-program=%{ooo_prefix}/%{ooo_home}/program/soffice.bin

%build
make clean
make @PACKAGE@.oxt

%install
rm -rf $RPM_BUILD_ROOT
mkdir -p $RPM_BUILD_ROOT/%ooo_prefix/%ooo_home/share/extension/install/
install -m 644 @PACKAGE@.oxt $RPM_BUILD_ROOT/%ooo_prefix/%ooo_home/share/extension/install/

%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root)
%ooo_prefix/%ooo_home/share/extension/install/@PACKAGE@.oxt

%post
unopkg add --shared @PACKAGE@.oxt

%preun
unopkg remove --shared @PACKAGE@.oxt



